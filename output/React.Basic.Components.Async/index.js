// Generated by purs version 0.13.6
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Effect_Exception from "../Effect.Exception/index.js";
import * as React_Basic from "../React.Basic/index.js";
var ReplaceFiber = (function () {
    function ReplaceFiber(value0) {
        this.value0 = value0;
    };
    ReplaceFiber.create = function (value0) {
        return new ReplaceFiber(value0);
    };
    return ReplaceFiber;
})();
var UpdateJSX = (function () {
    function UpdateJSX(value0) {
        this.value0 = value0;
    };
    UpdateJSX.create = function (value0) {
        return new UpdateJSX(value0);
    };
    return UpdateJSX;
})();
var component = React_Basic.createComponent("Async");
var asyncWithLoader = function (loader) {
    var render = function (self) {
        return Data_Maybe.fromMaybe(loader)(self.state.jsx);
    };
    var kill = (function () {
        var $8 = Effect_Aff.killFiber(Effect_Exception.error("Cancelled"));
        return function ($9) {
            return Effect_Aff.launchAff_($8($9));
        };
    })();
    var launch = function (self) {
        return function __do() {
            var fiber = Effect_Aff.launchAff(Control_Bind.bind(Effect_Aff.bindAff)(self.props)(function (jsx) {
                return Effect_Class.liftEffect(Effect_Aff.monadEffectAff)(self.setState(function (v) {
                    var $2 = {};
                    for (var $3 in v) {
                        if ({}.hasOwnProperty.call(v, $3)) {
                            $2[$3] = v[$3];
                        };
                    };
                    $2.jsx = new Data_Maybe.Just(jsx);
                    return $2;
                }));
            }))();
            return self.setStateThen(function (v) {
                var $5 = {};
                for (var $6 in v) {
                    if ({}.hasOwnProperty.call(v, $6)) {
                        $5[$6] = v[$6];
                    };
                };
                $5.jsx = Data_Maybe.Nothing.value;
                $5.pendingFiber = fiber;
                return $5;
            })(kill(self.state.pendingFiber))();
        };
    };
    var initialState = {
        jsx: Data_Maybe.Nothing.value,
        pendingFiber: Control_Applicative.pure(Effect_Aff.applicativeFiber)(Data_Unit.unit)
    };
    var cleanup = function (self) {
        return kill(self.state.pendingFiber);
    };
    return React_Basic.make()(component)({
        initialState: initialState,
        render: render,
        didMount: launch,
        willUnmount: cleanup
    });
};
var async = asyncWithLoader(React_Basic.empty);
export {
    async,
    asyncWithLoader
};
